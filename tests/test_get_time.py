import pytest
import cv2
import vf_cv

DIR = "assets/test_images/"

test_data = [
    [f"{DIR}720p/time/6575_invalid_time_28_last.png", "endround", 720, False],
    [f"{DIR}720p/time/6575_invalid_time_28.png", "endround", 720, False],
    [
        f"{DIR}720p/time/6850_0_1_42_Kage_vs_40_Vanessa_knockout_for_player1_20.70.png",
        "endround",
        720,
        False,
    ],
    [f"{DIR}720p/time/2116_invalid_time_35_33_last.png", "33", 720, False],
    [f"{DIR}720p/time/2116_invalid_time_35_33.png", "33", 720, False],
    [f"{DIR}720p/time/6573_invalid_time_28_last.png", "endround", 720, False],
    [f"{DIR}720p/time/6573_invalid_time_28.png", "endround", 720, False],
    [f"{DIR}720p/time/5753_invalid_time_23_28.png", "22", 720, False],
    [f"{DIR}720p/time/7960_invalid_time_15_10.png", "endround", 720, False],
    [f"{DIR}720p/time/7960_invalid_time_15_10_last.png", "endround", 720, False],
    [
        f"{DIR}720p/time/3483_0_1_41_Lion_vs_42_Shun_knockout_for_player2_13.38.png",
        "endround",
        720,
        False,
    ],
    [f"{DIR}720p/time/2094_invalid_time_37_35_last.png", "35", 720, False],
    [f"{DIR}720p/time/2094_invalid_time_37_35.png", "35", 720, False],
    [f"{DIR}720p/time/7528_invalid_time_19.png", "endround", 720, False],
    [f"{DIR}720p/time/7848_invalid_time_27_25.png", "26", 720, False],
    [f"{DIR}1080p/time/3697_invalid_time_29_25.png", "endround", 1080, False],
    [f"{DIR}480p/time/26_68_01.png", "endround", 480, False],
    [f"{DIR}720p/time/1357_invalid_time_25_20_endround.png", "endround", 720, False],
    [f"{DIR}720p/time/7883_invalid_time_28_29_endround.png", "endround", 720, False],
    [f"{DIR}720p/time/roundover_02.png", "endround", 720, False],
    [f"{DIR}720p/time/28_00_01.png", "endround", 720, False],
    [f"{DIR}720p/time/4494_invalid_time_28_24.png", "24", 720, False],
    [f"{DIR}720p/time/4494_invalid_time_28_24_last.png", "24", 720, False],
    [f"{DIR}480p/time/1051_invalid_time_38_33_last.png", "33", 480, False],
    [f"{DIR}480p/time/34_96_01.png", "34", 480, False],
    [f"{DIR}480p/time/1051_invalid_time_38_33.png", "33", 480, False],
    [f"{DIR}1080p/time/3287_invalid_time_36_30.png", "36", 1080, False],
    [
        f"{DIR}720p/time/5395_0_1_41_Aoi_vs_41_Jean_knockout_for_player1_27.38_endround.png",
        "endround",
        720,
        False,
    ],
    [f"{DIR}720p/time/6228_invalid_time_28_29.png", "27", 720, False],
    [f"{DIR}720p/time/8794_invalid_time_36_30.png", "36", 720, False],
    [f"{DIR}480p/time/970_invalid_time_38_36.png", "37", 480, False],
    [f"{DIR}1080p/time/3251_invalid_time_37_35.png", "36", 1080, False],
    [f"{DIR}720p/time/3344_invalid_time_16_10.png", "15", 720, False],
    [f"{DIR}480p/time/1072_invalid_time_38_36.png", "37", 480, False],
    [f"{DIR}720p/time/6157_invalid_time_25_23.png", "24", 720, False],
    [f"{DIR}720p/time/1988_invalid_time_38_31.png", "37", 720, False],
    [f"{DIR}480p/time/18_85_01.png", "18", 480, False],
    [f"{DIR}480p/time/08_00_01.png", "8", 480, False],
    [f"{DIR}480p/time/29_88_01.png", "29", 480, False],
    [f"{DIR}1080p/time/7352_invalid_time_26_20.png", "endround", 720, False],
    [f"{DIR}480p/time/38_96_02.png", "38", 480, False],
    [f"{DIR}480p/time/8_85_01.png", "8", 480, False],
    [f"{DIR}480p/time/8_85_02.png", "8", 480, False],
    [f"{DIR}720p/time/roundover_01.png", "endround", 720, False],
    [f"{DIR}720p/time/10_90_01.png", "10", 720, False],
    [f"{DIR}720p/time/39_98.png", "39", 720, False],
    [f"{DIR}1080p/time/38_96_01.png", "38", 1080, False],
    [f"{DIR}720p/time/1916_invalid_time_38_39.png", "37", 1080, False],
    [f"{DIR}720p/time/10213_invalid_time.png", "7", 720, False],
    [f"{DIR}480p/time/38_26.png", "38", 720, False],
    [f"{DIR}480p/time/27_98_01.png", "27", 480, False],
    [f"{DIR}480p/time/26_91_01.png", "26", 480, False],
    [f"{DIR}480p/time/36_88.png", "36", 720, False],
    [f"{DIR}720p/time/25_86_01.png", "25", 720, False],
    [f"{DIR}480p/time/36_98_02.png", "36", 480, False],
    [f"{DIR}480p/time/5_20_01.png", "5", 480, False],
    [f"{DIR}480p/time/16_96_01.png", "16", 480, False],
    [f"{DIR}480p/time/25_96_01.png", "25", 480, False],
    [f"{DIR}720p/time/6544_invalid_time.png", "35", 720, False],
    [f"{DIR}1080p/time/2084_invalid_time_35_36.png", "35", 1080, False],
    [f"{DIR}1080p/time/45_00_01.png", "endround", 1080, False],
    [f"{DIR}480p/time/4_98_01.png", "4", 480, False],
    [f"{DIR}480p/time/25_95_01.png", "25", 480, False],
    [f"{DIR}720p/time/27_26_01.png", "27", 720, False],
    [f"{DIR}720p/time/29_98_01.png", "29", 720, False],
    [f"{DIR}480p/time/14_65_01.png", "14", 480, False],
    [f"{DIR}1080p/time/41_78_01.png", "41", 1080, False],
    [f"{DIR}1080p/time/2201_invalid_time_33_38.png", "endround", 1080, False],
    [f"{DIR}480p/time/41_26.png", "41", 720, False],
    [f"{DIR}720p/time/5507_invalid_time_37_33.png", "37", 720, False],
    [f"{DIR}720p/time/2048_invalid_time_38_33.png", "37", 720, False],
    [f"{DIR}1080p/time/2186_invalid_time_30_35.png", "endround", 720, False],
    [f"{DIR}720p/time/35_38_01.png", "35", 720, False],
    [f"{DIR}1080p/time/40_98_01.png", "40", 1080, False],
    [f"{DIR}1080p/time/1620_invalid_time_None.png", "42", 1080, False],
    [f"{DIR}720p/time/1677_invalid_time.png", "41", 1080, False],
    [f"{DIR}1080p/time/39_50_01.png", "39", 1080, False],
    [f"{DIR}720p/time/5649_invalid_time_20_25.png", "endround", 720, False],
    [f"{DIR}720p/time/1796_invalid_time.png", "39", 1080, False],
    [f"{DIR}720p/time/39_98_01.png", "39", 720, False],
    [f"{DIR}720p/time/19_98_01.png", "19", 720, False],
    [f"{DIR}720p/time/19_68_01.png", "19", 720, False],
    [f"{DIR}720p/time/16_98_01.png", "16", 720, False],
    [f"{DIR}720p/time/2105_invalid_time.png", "32", 720, False],
    [f"{DIR}720p/time/010163_invalid_time.png", "8", 720, False],
    [f"{DIR}720p/time/1692_invalid_time.png", "41", 720, False],
    [f"{DIR}720p/time/3573_invalid_time.png", "endround", 720, False],
    [f"{DIR}720p/time/5397_invalid_time.png", "endround", 720, False],
    [f"{DIR}720p/time/37_98_01.png", "37", 720, False],
    [f"{DIR}1080p/time/40_73_01.png", "40", 1080, False],
    [f"{DIR}720p/time/34_98_01.png", "34", 720, False],
    [f"{DIR}720p/time/35_58_01.png", "35", 720, False],
    [f"{DIR}720p/time/33_08_01.png", "endround", 720, False],
    [f"{DIR}1080p/time/29_05_01.png", "29", 1080, False],
    [f"{DIR}1080p/time/29_46_01.png", "29", 1080, False],
    [f"{DIR}720p/time/28_98_01.png", "28", 720, False],
    [f"{DIR}720p/time/28_76_01.png", "28", 720, False],
    [f"{DIR}480p/time/roundover_05.png", "endround", 720, False],
    [f"{DIR}480p/time/roundover_04.png", "endround", 480, False],
    [f"{DIR}480p/time/roundover_03.png", "endround", 480, False],
    [f"{DIR}480p/time/4_13_01.png", "4", 480, False],
    [f"{DIR}480p/time/9_75_01.png", "9", 480, False],
    [f"{DIR}480p/time/9_96_01.png", "9", 480, False],
    [f"{DIR}480p/time/9_xx_01.png", "endround", 480, False],
    [f"{DIR}480p/time/roundover_02.png", "endround", 480, False],
    [f"{DIR}480p/time/8_86_01.png", "8", 480, False],
    [f"{DIR}480p/time/08_95_01.png", "8", 480, False],
    [f"{DIR}480p/time/09_88_01.png", "9", 480, False],
    [f"{DIR}480p/time/40_05_01.png", "40", 480, False],
    [f"{DIR}480p/time/32_21_01.png", "32", 480, False],
    [f"{DIR}480p/time/39_95_01.png", "39", 480, False],
    [f"{DIR}480p/time/roundover.png", "endround", 480, False],
    [f"{DIR}480p/time/30_96_01.png", "30", 480, False],
    [f"{DIR}480p/time/19_95_01.png", "19", 480, False],
    [f"{DIR}480p/time/26_98_02.png", "26", 480, False],
    [f"{DIR}480p/time/32_08_01.png", "32", 480, False],
    [f"{DIR}480p/time/36_93_01.png", "36", 480, False],
    [f"{DIR}480p/time/39_98_01.png", "39", 480, False],
    [f"{DIR}480p/time/23_78_01.png", "23", 480, False],
    [f"{DIR}480p/time/23_96_01.png", "23", 480, False],
    [f"{DIR}480p/time/29_19_01.png", "29", 480, False],
    [f"{DIR}480p/time/26_33_01.png", "26", 480, False],
    [f"{DIR}480p/time/29_96_02.png", "29", 480, False],
    [f"{DIR}480p/time/22_98_01.png", "22", 480, False],
    [f"{DIR}480p/time/26_63_01.png", "26", 480, False],
    [f"{DIR}480p/time/26_98_01.png", "26", 480, False],
    [f"{DIR}480p/time/36_96_01.png", "36", 480, False],
    [f"{DIR}480p/time/17_65_01.png", "endround", 480, False],
    [f"{DIR}480p/time/27_48_01.png", "27", 480, False],
    [f"{DIR}480p/time/27_66_01.png", "27", 480, False],
    [f"{DIR}480p/time/28_08_01.png", "28", 480, False],
    [f"{DIR}480p/time/29_96_01.png", "29", 480, False],
    [f"{DIR}480p/time/36_86_01.png", "36", 480, False],
    [f"{DIR}480p/time/36_98_01.png", "36", 480, False],
    [f"{DIR}480p/time/38_73_01.png", "38", 480, False],
    [f"{DIR}480p/time/38_96_01.png", "38", 480, False],
    [f"{DIR}480p/time/39_76_01.png", "39", 480, False],
    [f"{DIR}480p/time/39_96_02.png", "39", 480, False],
    [f"{DIR}480p/time/39_96_01.png", "39", 480, False],
    [f"{DIR}480p/time/42_46_01.png", "42", 480, False],
    [f"{DIR}480p/time/42_98.png", "42", 480, False],
    [f"{DIR}1080p/time/05_31_02.png", "5", 1080, False],
    [f"{DIR}1080p/time/05_31_01.png", "5", 1080, False],
    [f"{DIR}480p/time/41_78.png", "41", 720, False],
    [f"{DIR}1080p/time/29_85_01.png", "29", 1080, False],
    [f"{DIR}1080p/time/41_76_01.png", "41", 1080, False],
    [f"{DIR}1080p/time/18_23_01.png", "endround", 1080, False],
    [f"{DIR}1080p/time/42_73_01.png", "42", 1080, False],
    [f"{DIR}1080p/time/42_16_01.png", "42", 1080, False],
    [f"{DIR}1080p/time/43_66_01.png", "43", 1080, False],
    [f"{DIR}480p/time/45_00_02.png", "45", 480, False],
    [f"{DIR}480p/time/45_00.png", "45", 480, False],
    [f"{DIR}480p/time/18_00_01.png", "18", 480, False],
    [f"{DIR}720p/time/08_00_01.png", "8", 720, False],
    [f"{DIR}720p/time/09_96_01.png", "9", 720, False],
    [f"{DIR}720p/time/10_08_01.png", "10", 720, False],
    [f"{DIR}720p/time/42_75.png", "42", 720, False],
    [f"{DIR}480p/time/43_45.png", "43", 720, False],
    [f"{DIR}480p/time/16_75.png", "16", 720, False],
    [f"{DIR}480p/time/20_16.png", "20", 720, False],
    [f"{DIR}480p/time/29_66.png", "29", 720, False],
    [f"{DIR}480p/time/24_76.png", "24", 720, False],
    [f"{DIR}480p/time/30_56.png", "30", 720, False],
    [f"{DIR}480p/time/44_06.png", "44", 720, False],
    [f"{DIR}480p/time/44_18.png", "44", 720, False],
    [f"{DIR}480p/time/40_16.png", "40", 720, False],
    [f"{DIR}480p/time/40_66.png", "40", 720, False],
    [f"{DIR}480p/time/40_76.png", "40", 720, False],
    [f"{DIR}480p/time/39_46.png", "39", 720, False],
    [f"{DIR}480p/time/39_88.png", "39", 720, False],
    [f"{DIR}480p/time/37_78.png", "37", 720, False],
    [f"{DIR}480p/time/22_76.png", "22", 720, False],
    [f"{DIR}480p/time/30_96.png", "30", 720, False],
    [f"{DIR}480p/time/31_16.png", "31", 720, False],
    [f"{DIR}480p/time/32_36.png", "32", 720, False],
    [f"{DIR}480p/time/33_36.png", "33", 720, False],
    [f"{DIR}480p/time/33_18.png", "33", 720, False],
    [f"{DIR}480p/time/34_96.png", "34", 720, False],
    [f"{DIR}480p/time/35_28.png", "35", 720, False],
    [f"{DIR}480p/time/37_68.png", "37", 720, False],
    [f"{DIR}480p/time/43_96.png", "43", 720, False],
]


@pytest.mark.parametrize(
    "image_filename, expected_time_seconds, resolution, DEBUG",
    test_data,
)
def test_get_time_seconds(
    image_filename,
    expected_time_seconds,
    resolution,
    DEBUG,
):
    """Tests OCR for getting time remaining during a match with 480p resolution"""

    image = cv2.imread(image_filename)
    assert image is not None, f"{image_filename} is none"

    height = image.shape[0]
    assert (
        height == resolution
    ), f"{image_filename} is {height}p instead of expected {resolution}p"

    timer = vf_cv.Timer()
    timer.set_frame(image)

    actual_time_seconds = timer.get_time_seconds(DEBUG)
    assert (
        expected_time_seconds == actual_time_seconds
    ), f"{actual_time_seconds} not expected value of {expected_time_seconds} for {image_filename}"
