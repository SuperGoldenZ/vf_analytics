import pytest
import cv2
import vf_cv

DIR = "assets/test_images/"

test_data_other = [
    f"{DIR}720p/time/endround_08.png",
    f"{DIR}720p/time/endround_07.png",
    f"{DIR}720p/time/endround_06.png",
    f"{DIR}1080p/winning_frame/endround_02.png",
]


@pytest.mark.parametrize(
    "image_filename",
    test_data_other,
)
def test_other(image_filename):
    image = cv2.imread(image_filename)
    assert image is not None, f"{image_filename} is none"

    timer = vf_cv.Timer()

    stage = None

    timer.set_frame(image, stage)

    actual_endround_other = timer.is_endround_other(False)

    assert actual_endround_other == True, f"not endround as expected {image_filename}"


test_data_720p = [
    [f"{DIR}1080p/time/19_02.png", "19", 1080, False],
    [f"{DIR}1080p/time/19_01.png", "19", 1080, False],
    [f"{DIR}1080p/time/28_45.png", "28", 1080, False],
    [f"{DIR}720p/time/29_04.png", "29", 720, False],
    [f"{DIR}720p/time/39_02.png", "39", 720, False],
    [f"{DIR}720p/time/26_03.png", "26", 720, False],
    [f"{DIR}720p/time/9_01.png", "9", 720, False],
    [f"{DIR}720p/time/29_02.png", "29", 720, False],
    [f"{DIR}720p/time/32_01.png", "32", 720, False],
    [f"{DIR}720p/time/35_02.png", "35", 720, False],
    [f"{DIR}720p/time/24_01.png", "24", 720, False],
    [f"{DIR}720p/time/29_01.png", "29", 720, False],
    [f"{DIR}720p/time/26_01.png", "26", 720, False],
    [f"{DIR}720p/time/16_01.png", "16", 720, False],
    [f"{DIR}720p/time/25_01.png", "25", 720, False],
    [f"{DIR}720p/time/29_03.png", "29", 720, False],
    [f"{DIR}720p/time/29_16_01.png", "29", 720, False],
    [f"{DIR}720p/time/38_01.png", "38", 720, False],
    [f"{DIR}720p/time/7848_invalid_time_27_25.png", "26", 720, False],
    [f"{DIR}720p/time/39_01.png", "39", 720, False],
    [f"{DIR}720p/time/35_01.png", "35", 720, False],
    [f"{DIR}720p/time/24_91.png", "24", 720, False],
    [f"{DIR}720p/time/38_96.png", "38", 720, False],
    [f"{DIR}720p/time/31_55.png", "31", 720, False],
    [f"{DIR}720p/time/38_83.png", "38", 720, False],
    [f"{DIR}720p/time/39_83.png", "39", 720, False],
    [f"{DIR}720p/time/3943_unknown_skip.png", "37", 720, False],
    [f"{DIR}720p/time/2790_unknown_skip.png", "22", 720, False],
    [f"{DIR}720p/time/2479_unknown_skip.png", "27", 720, False],
    [f"{DIR}720p/time/2116_invalid_time_35_33_last.png", "33", 720, False],
    [f"{DIR}720p/time/2116_invalid_time_35_33.png", "33", 720, False],
    [f"{DIR}720p/time/5753_invalid_time_23_28.png", "22", 720, False],
    [f"{DIR}720p/time/2094_invalid_time_37_35_last.png", "35", 720, False],
    [f"{DIR}720p/time/2094_invalid_time_37_35.png", "35", 720, False],
]

test_data = [
    [f"{DIR}360p/time/13_01.png", "13", 360, False],
    [f"{DIR}360p/time/23_01.png", "23", 360, False],
    [f"{DIR}360p/time/39_06.png", "39", 360, False],
    [f"{DIR}360p/time/39_05.png", "39", 360, False],
    [f"{DIR}360p/time/27_06.png", "27", 360, False],
    [f"{DIR}360p/time/35_05.png", "35", 360, False],
    [f"{DIR}360p/knockout/knockout_43.png", "19", 360, False],
    [f"{DIR}360p/time/27_05.png", "27", 360, False],
    [f"{DIR}360p/time/29_01.png", "29", 360, False],
    [f"{DIR}360p/time/43_05.png", "43", 360, False],
    [f"{DIR}360p/time/29_02.png", "29", 360, False],
    [f"{DIR}360p/time/31_03.png", "31", 360, False],
    [f"{DIR}360p/time/26_02.png", "26", 360, False],
    [f"{DIR}360p/time/36_02.png", "36", 360, False],
    [f"{DIR}360p/time/19_02.png", "19", 360, False],
    [f"{DIR}360p/time/33_01.png", "33", 360, False],
    [f"{DIR}360p/time/30_03.png", "30", 360, False],
    [f"{DIR}360p/time/27_04.png", "27", 360, False],
    [f"{DIR}360p/time/43_04.png", "43", 360, False],
    [f"{DIR}360p/time/42_02.png", "42", 360, False],
    [f"{DIR}360p/time/43_03.png", "43", 360, False],
    [f"{DIR}360p/time/38_04.png", "38", 360, False],
    [f"{DIR}360p/time/40_03.png", "40", 360, False],
    [f"{DIR}360p/time/37_01.png", "37", 360, False],
    [f"{DIR}360p/time/35_04.png", "35", 360, False],
    [f"{DIR}360p/time/27_03.png", "27", 360, False],
    [f"{DIR}360p/time/34_03.png", "34", 360, False],
    [f"{DIR}360p/time/34_02.png", "34", 360, False],
    [f"{DIR}360p/time/27_02.png", "27", 360, False],
    [f"{DIR}360p/time/43_02.png", "43", 360, False],
    [f"{DIR}360p/time/09_02.png", "9", 360, False],
    [f"{DIR}360p/time/17_01.png", "17", 360, False],
    [f"{DIR}360p/time/2227_invalid time.png", "endround", 360, False],
    [f"{DIR}360p/time/2973_invalid time.png", "endround", 360, False],
    [f"{DIR}360p/time/3891_invalid time.png", "endround", 360, False],
    [f"{DIR}360p/time/4583_invalid time.png", "endround", 360, False],
    [f"{DIR}360p/time/35_03.png", "35", 360, False],
    [f"{DIR}360p/time/5283_invalid time.png", "endround", 360, False],
    [f"{DIR}360p/time/4031_invalid time.png", "endround", 360, False],
    [f"{DIR}360p/time/18_01.png", "18", 360, False],
    [f"{DIR}360p/time/35_02.png", "35", 360, False],
    [f"{DIR}360p/time/40_02.png", "40", 360, False],
    [f"{DIR}360p/time/43_01.png", "43", 360, False],
    [f"{DIR}360p/time/09_01.png", "9", 360, False],
    [f"{DIR}360p/time/41_02.png", "41", 360, False],
    [f"{DIR}360p/time/2160_invalid time.png", "endround", 360, False],
    [f"{DIR}360p/time/28_02.png", "28", 360, False],
    [f"{DIR}360p/time/30_02.png", "30", 360, False],
    [f"{DIR}360p/time/39_03.png", "39", 360, False],
    [f"{DIR}360p/time/38_03.png", "38", 360, False],
    [f"{DIR}360p/time/40_01.png", "40", 360, False],
    [f"{DIR}360p/time/20_01.png", "20", 360, False],
    [f"{DIR}360p/time/27_01.png", "27", 360, False],
    [f"{DIR}360p/time/26_01.png", "26", 360, False],
    [f"{DIR}360p/time/38_02.png", "38", 360, False],
    [f"{DIR}360p/time/30_01.png", "30", 360, False],
    [f"{DIR}360p/time/38_01.png", "38", 360, False],
    [f"{DIR}360p/time/31_02.png", "31", 360, False],
    [f"{DIR}360p/time/19_01.png", "19", 360, False],
    [f"{DIR}360p/time/34_01.png", "34", 360, False],
    [f"{DIR}360p/time/37_05.png", "37", 360, False],
    [f"{DIR}360p/time/41_01.png", "41", 360, False],
    [f"{DIR}360p/time/37_04.png", "37", 360, False],
    [f"{DIR}360p/time/1982_invalid time.png", "endround", 360, False],
    [f"{DIR}360p/time/1981_invalid time.png", "endround", 360, False],
    [f"{DIR}360p/time/1980_invalid time.png", "endround", 360, False],
    [f"{DIR}360p/time/37_03.png", "37", 360, False],
    [f"{DIR}360p/time/39_02.png", "39", 360, False],
    [f"{DIR}360p/time/42_01.png", "42", 360, False],
    [f"{DIR}360p/time/28_01.png", "28", 360, False],
    [f"{DIR}360p/time/31_01.png", "31", 360, False],
    [f"{DIR}360p/time/36_01.png", "36", 360, False],
    [f"{DIR}360p/time/37_02.png", "37", 360, False],
    [f"{DIR}360p/time/39_01.png", "39", 360, False],
    [f"{DIR}360p/time/32_01.png", "32", 360, False],
    [f"{DIR}360p/time/35_01.png", "35", 360, False],
    [f"{DIR}360p/time/37_69_01.png", "37", 360, False],
    [f"{DIR}360p/time/38_45_01.png", "38", 360, False],
    [f"{DIR}480p/time/2242_invalid time.png", "26", 480, False],
    [f"{DIR}480p/time/2887_invalid time.png", "19", 480, False],
    [f"{DIR}480p/time/1773_invalid time.png", "13", 480, False],
    [f"{DIR}480p/time/1324_fight_29_matches_2.png", "28", 480, False],
    [f"{DIR}1080p/time/2186_invalid_time_30_35.png", "endround", 720, False],
    [f"{DIR}1080p/time/3697_invalid_time_29_25.png", "endround", 1080, False],
    [f"{DIR}480p/time/26_68_01.png", "endround", 480, False],
    [f"{DIR}720p/time/1357_invalid_time_25_20_endround.png", "endround", 720, False],
    [f"{DIR}720p/time/7883_invalid_time_28_29_endround.png", "endround", 720, False],
    [f"{DIR}720p/time/roundover_02.png", "endround", 720, False],
    [f"{DIR}720p/time/28_00_01.png", "endround", 720, False],
    [f"{DIR}720p/time/4494_invalid_time_28_24.png", "24", 720, False],
    [f"{DIR}720p/time/4494_invalid_time_28_24_last.png", "24", 720, False],
    [f"{DIR}480p/time/1051_invalid_time_38_33_last.png", "33", 480, False],
    [f"{DIR}480p/time/34_96_01.png", "34", 480, False],
    [f"{DIR}480p/time/1051_invalid_time_38_33.png", "33", 480, False],
    [f"{DIR}1080p/time/3287_invalid_time_36_30.png", "36", 1080, False],
    [
        f"{DIR}720p/time/5395_0_1_41_Aoi_vs_41_Jean_knockout_for_player1_27.38_endround.png",
        "endround",
        720,
        False,
    ],
    [f"{DIR}720p/time/6228_invalid_time_28_29.png", "27", 720, False],
    [f"{DIR}720p/time/8794_invalid_time_36_30.png", "36", 720, False],
    [f"{DIR}480p/time/970_invalid_time_38_36.png", "37", 480, False],
    [f"{DIR}1080p/time/3251_invalid_time_37_35.png", "36", 1080, False],
    [f"{DIR}720p/time/3344_invalid_time_16_10.png", "15", 720, False],
    [f"{DIR}480p/time/1072_invalid_time_38_36.png", "37", 480, False],
    [f"{DIR}720p/time/6157_invalid_time_25_23.png", "24", 720, False],
    [f"{DIR}720p/time/1988_invalid_time_38_31.png", "37", 720, False],
    [f"{DIR}480p/time/18_85_01.png", "18", 480, False],
    [f"{DIR}480p/time/08_00_01.png", "8", 480, False],
    [f"{DIR}480p/time/29_88_01.png", "29", 480, False],
    [f"{DIR}1080p/time/7352_invalid_time_26_20.png", "endround", 720, False],
    [f"{DIR}480p/time/38_96_02.png", "38", 480, False],
    [f"{DIR}480p/time/8_85_01.png", "8", 480, False],
    [f"{DIR}480p/time/8_85_02.png", "8", 480, False],
    [f"{DIR}720p/time/roundover_01.png", "endround", 720, False],
    [f"{DIR}720p/time/10_90_01.png", "10", 720, False],
    [f"{DIR}720p/time/39_98.png", "39", 720, False],
    [f"{DIR}1080p/time/38_96_01.png", "38", 1080, False],
    [f"{DIR}720p/time/1916_invalid_time_38_39.png", "37", 1080, False],
    [f"{DIR}720p/time/10213_invalid_time.png", "7", 720, False],
    [f"{DIR}480p/time/38_26.png", "38", 720, False],
    [f"{DIR}480p/time/27_98_01.png", "27", 480, False],
    [f"{DIR}480p/time/26_91_01.png", "26", 480, False],
    [f"{DIR}480p/time/36_88.png", "36", 720, False],
    [f"{DIR}720p/time/25_86_01.png", "25", 720, False],
    [f"{DIR}480p/time/36_98_02.png", "36", 480, False],
    [f"{DIR}480p/time/5_20_01.png", "5", 480, False],
    [f"{DIR}480p/time/16_96_01.png", "16", 480, False],
    [f"{DIR}480p/time/25_96_01.png", "25", 480, False],
    [f"{DIR}720p/time/6544_invalid_time.png", "35", 720, False],
    [f"{DIR}1080p/time/2084_invalid_time_35_36.png", "35", 1080, False],
    [f"{DIR}1080p/time/45_00_01.png", "endround", 1080, False],
    [f"{DIR}480p/time/4_98_01.png", "4", 480, False],
    [f"{DIR}480p/time/25_95_01.png", "25", 480, False],
    [f"{DIR}720p/time/27_26_01.png", "27", 720, False],
    [f"{DIR}720p/time/29_98_01.png", "29", 720, False],
    [f"{DIR}480p/time/14_65_01.png", "14", 480, False],
    [f"{DIR}1080p/time/41_78_01.png", "41", 1080, False],
    [f"{DIR}1080p/time/2201_invalid_time_33_38.png", "endround", 1080, False],
    [f"{DIR}480p/time/41_26.png", "41", 720, False],
    [f"{DIR}720p/time/5507_invalid_time_37_33.png", "37", 720, False],
    [f"{DIR}720p/time/2048_invalid_time_38_33.png", "37", 720, False],
    [f"{DIR}720p/time/35_38_01.png", "35", 720, False],
    [f"{DIR}1080p/time/40_98_01.png", "40", 1080, False],
    [f"{DIR}1080p/time/1620_invalid_time_None.png", "42", 1080, False],
    [f"{DIR}720p/time/1677_invalid_time.png", "41", 1080, False],
    [f"{DIR}1080p/time/39_50_01.png", "39", 1080, False],
    [f"{DIR}720p/time/5649_invalid_time_20_25.png", "endround", 720, False],
    [f"{DIR}720p/time/1796_invalid_time.png", "39", 1080, False],
    [f"{DIR}720p/time/39_98_01.png", "39", 720, False],
    [f"{DIR}720p/time/19_98_01.png", "19", 720, False],
    [f"{DIR}720p/time/19_68_01.png", "19", 720, False],
    [f"{DIR}720p/time/16_98_01.png", "16", 720, False],
    [f"{DIR}720p/time/2105_invalid_time.png", "32", 720, False],
    [f"{DIR}720p/time/010163_invalid_time.png", "8", 720, False],
    [f"{DIR}720p/time/1692_invalid_time.png", "41", 720, False],
    [f"{DIR}720p/time/3573_invalid_time.png", "endround", 720, False],
    [f"{DIR}720p/time/37_98_01.png", "37", 720, False],
    [f"{DIR}1080p/time/40_73_01.png", "40", 1080, False],
    [f"{DIR}720p/time/34_98_01.png", "34", 720, False],
    [f"{DIR}720p/time/35_58_01.png", "35", 720, False],
    [f"{DIR}720p/time/33_08_01.png", "endround", 720, False],
    [f"{DIR}1080p/time/29_05_01.png", "29", 1080, False],
    [f"{DIR}1080p/time/29_46_01.png", "29", 1080, False],
    [f"{DIR}720p/time/28_98_01.png", "28", 720, False],
    [f"{DIR}720p/time/28_76_01.png", "28", 720, False],
    [f"{DIR}480p/time/roundover_05.png", "endround", 720, False],
    [f"{DIR}480p/time/roundover_04.png", "endround", 480, False],
    [f"{DIR}480p/time/roundover_03.png", "endround", 480, False],
    [f"{DIR}480p/time/4_13_01.png", "4", 480, False],
    [f"{DIR}480p/time/9_75_01.png", "9", 480, False],
    [f"{DIR}480p/time/9_96_01.png", "9", 480, False],
    [f"{DIR}480p/time/9_xx_01.png", "endround", 480, False],
    [f"{DIR}480p/time/roundover_02.png", "endround", 480, False],
    [f"{DIR}480p/time/8_86_01.png", "8", 480, False],
    [f"{DIR}480p/time/08_95_01.png", "8", 480, False],
    [f"{DIR}480p/time/09_88_01.png", "9", 480, False],
    # [f"{DIR}480p/time/40_05_01.png", "40", 480, False],
    [f"{DIR}480p/time/32_21_01.png", "32", 480, False],
    [f"{DIR}480p/time/39_95_01.png", "39", 480, False],
    [f"{DIR}480p/time/roundover.png", "endround", 480, False],
    # [f"{DIR}480p/time/30_96_01.png", "30", 480, False],
    [f"{DIR}480p/time/19_95_01.png", "19", 480, False],
    [f"{DIR}480p/time/26_98_02.png", "26", 480, False],
    [f"{DIR}480p/time/32_08_01.png", "32", 480, False],
    [f"{DIR}480p/time/36_93_01.png", "36", 480, False],
    [f"{DIR}480p/time/39_98_01.png", "39", 480, False],
    [f"{DIR}480p/time/23_78_01.png", "23", 480, False],
    [f"{DIR}480p/time/23_96_01.png", "23", 480, False],
    [f"{DIR}480p/time/29_19_01.png", "29", 480, False],
    [f"{DIR}480p/time/26_33_01.png", "26", 480, False],
    [f"{DIR}480p/time/29_96_02.png", "29", 480, False],
    [f"{DIR}480p/time/22_98_01.png", "22", 480, False],
    [f"{DIR}480p/time/26_63_01.png", "26", 480, False],
    [f"{DIR}480p/time/26_98_01.png", "26", 480, False],
    [f"{DIR}480p/time/36_96_01.png", "36", 480, False],
    [f"{DIR}480p/time/17_65_01.png", "endround", 480, False],
    [f"{DIR}480p/time/27_48_01.png", "27", 480, False],
    [f"{DIR}480p/time/27_66_01.png", "27", 480, False],
    [f"{DIR}480p/time/28_08_01.png", "28", 480, False],
    [f"{DIR}480p/time/29_96_01.png", "29", 480, False],
    [f"{DIR}480p/time/36_86_01.png", "36", 480, False],
    [f"{DIR}480p/time/36_98_01.png", "36", 480, False],
    [f"{DIR}480p/time/38_73_01.png", "38", 480, False],
    [f"{DIR}480p/time/38_96_01.png", "38", 480, False],
    [f"{DIR}480p/time/39_76_01.png", "39", 480, False],
    [f"{DIR}480p/time/39_96_02.png", "39", 480, False],
    [f"{DIR}480p/time/39_96_01.png", "39", 480, False],
    [f"{DIR}480p/time/42_46_01.png", "42", 480, False],
    [f"{DIR}480p/time/42_98.png", "42", 480, False],
    [f"{DIR}1080p/time/05_31_02.png", "5", 1080, False],
    [f"{DIR}1080p/time/05_31_01.png", "5", 1080, False],
    [f"{DIR}480p/time/41_78.png", "41", 720, False],
    [f"{DIR}1080p/time/29_85_01.png", "29", 1080, False],
    [f"{DIR}1080p/time/41_76_01.png", "41", 1080, False],
    [f"{DIR}1080p/time/18_23_01.png", "endround", 1080, False],
    [f"{DIR}1080p/time/42_73_01.png", "42", 1080, False],
    [f"{DIR}1080p/time/42_16_01.png", "42", 1080, False],
    [f"{DIR}1080p/time/43_66_01.png", "43", 1080, False],
    [f"{DIR}480p/time/45_00_02.png", "45", 480, False],
    [f"{DIR}480p/time/45_00.png", "45", 480, False],
    [f"{DIR}480p/time/18_00_01.png", "18", 480, False],
    [f"{DIR}720p/time/08_00_01.png", "8", 720, False],
    [f"{DIR}720p/time/09_96_01.png", "9", 720, False],
    [f"{DIR}720p/time/10_08_01.png", "10", 720, False],
    [f"{DIR}720p/time/42_75.png", "42", 720, False],
    [f"{DIR}480p/time/43_45.png", "43", 720, False],
    [f"{DIR}480p/time/16_75.png", "16", 720, False],
    [f"{DIR}480p/time/20_16.png", "20", 720, False],
    [f"{DIR}480p/time/29_66.png", "29", 720, False],
    [f"{DIR}480p/time/24_76.png", "24", 720, False],
    [f"{DIR}480p/time/30_56.png", "30", 720, False],
    [f"{DIR}480p/time/44_06.png", "44", 720, False],
    [f"{DIR}480p/time/44_18.png", "44", 720, False],
    [f"{DIR}480p/time/40_16.png", "40", 720, False],
    [f"{DIR}480p/time/40_66.png", "40", 720, False],
    [f"{DIR}480p/time/40_76.png", "40", 720, False],
    [f"{DIR}480p/time/39_46.png", "39", 720, False],
    [f"{DIR}480p/time/39_88.png", "39", 720, False],
    [f"{DIR}480p/time/37_78.png", "37", 720, False],
    [f"{DIR}480p/time/22_76.png", "22", 720, False],
    [f"{DIR}480p/time/30_96.png", "30", 720, False],
    [f"{DIR}480p/time/31_16.png", "31", 720, False],
    [f"{DIR}480p/time/32_36.png", "32", 720, False],
    [f"{DIR}480p/time/33_36.png", "33", 720, False],
    [f"{DIR}480p/time/33_18.png", "33", 720, False],
    [f"{DIR}480p/time/34_96.png", "34", 720, False],
    [f"{DIR}480p/time/35_28.png", "35", 720, False],
    [f"{DIR}480p/time/37_68.png", "37", 720, False],
    [f"{DIR}480p/time/43_96.png", "43", 720, False],
]


# @todo move back to all test data
@pytest.mark.parametrize(
    "image_filename, expected_time_seconds, resolution, DEBUG",
    test_data_720p,
)
def test_get_time_seconds(
    image_filename,
    expected_time_seconds,
    resolution,
    DEBUG,
):
    """Tests OCR for getting time remaining during a match with 480p resolution"""

    image = cv2.imread(image_filename)
    assert image is not None, f"{image_filename} is none"

    height = image.shape[0]
    assert (
        height == resolution
    ), f"{image_filename} is {height}p instead of expected {resolution}p"

    timer = vf_cv.Timer()

    stage = None

    if "1080p/time/28_45.png" in image_filename:
        stage = "Deep Mountain"

    timer.set_frame(image, stage)

    actual_time_seconds = timer.get_time_seconds(DEBUG)
    assert (
        expected_time_seconds == actual_time_seconds
    ), f"{actual_time_seconds} not expected value of {expected_time_seconds} for {image_filename}"
